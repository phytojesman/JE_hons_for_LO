geom_segment(data = fish.loadings.select, aes(x = 0, y = 0,
xend = Factor1, yend = Factor2,
)) +
geom_text(data=fish.loadings.select, aes(x= Factor1+0.22, y= Factor2+0.08,
label= paste0("italic('", species, "')")), parse = TRUE,
alpha=0.5, size=4) +
labs(title = "Larval fish copula ordination",
colour = "National Reference Station")
ggplot(cope.scores.meta) +
geom_point(aes(x = Factor1, y = Factor2, colour = factor(StationCode))) +
scale_colour_manual(values = c("#541352FF", "#FDE725FF", "#2f9aa0FF"),
labels = c("Maria Island", "North Stradbroke Island",
"Port Hacking")) +
theme_classic() +
geom_segment(data = cope.loadings.select, aes(x = 0, y = 0,
xend = Factor1, yend = Factor2,
)) +
geom_text(data=cope.loadings.select, aes(x= Factor1, y= Factor2+0.06, label= paste0("italic('", species, "')")), parse = TRUE,, alpha=0.5, size=4) +
labs(title = "Copepod copula ordination",
colour = "National Reference Station")
# load packages and data
library(mvabund)
library(ecoCopula)
library(tidyverse)
library(tweedie)
library(statmod)
library(zoo)
library(ggraph)
library(igraph)
data <- read.csv("stdset.csv") %>%
dplyr::select(where(~ !is.numeric(.) || is.numeric(.) &&
sum(., na.rm = T) > 0)) %>%
mutate(across(where(is.numeric), ~ na.approx(.,
na.rm = F,
rule = 2)))
meta <- data[1:9]
View(meta)
View(data)
bio_resp <- data[12:235] %>% mvabund()
formula = formula(bio_resp ~
meta$StationCode + meta$CTDSST_degC)
mod <- manyany(formula = formula,
data = meta,
fn = "glm", family = tweedie(var.power = 1.011,
link.power = 0),
var.power = 1.011)
plot(mod)
V(ig)$isolated <- degree(ig) == 0
ig <- cgr$best_graph$igraph_out
cgr <- cgr(mod, method = "AIC")
library(ggrepel)
# base igraph
ig <- cgr$best_graph$igraph_out
# remove isolated nodes
V(ig)$isolated <- degree(ig) == 0
# larval fish - connected graph only
node_degrees <- degree(ig)
labels <- ifelse(node_degrees > 0, V(ig)$name, NA)
labels2 <- V(ig)$name
# labels
degrees <- data.frame(labels, node_degrees)
labels <- labels %>% na.exclude()
labels <- labels %>% as.data.frame()
ic_fish_nodes <- c("Trachurus.novaezelandiae", "Engraulis.australis",
"Sardinops.sagax", "Scomber.australasicus")
ic_cope_nodes <- c("Acartia.tranteri", "Clausocalanus.furcatus",
"Diothonia.rigida", "Euterpina.acutifrons",
"Microsetella.norvegica", "Oithona.atlantica",
"Paracalanus.indicus", "Temora.turbinata")
ic_select_nodes <- c(ic_fish_nodes, ic_cope_nodes)
# subsetting igraph
all_nodes <- V(ig)$name
my_nodes <- intersect(select_nodes, all_nodes)
my_nodes <- intersect(ic_select_nodes, all_nodes)
subgraph <- induced_subgraph(ig, vids = my_nodes)
subgraph_tbl <- as_tbl_graph(subgraph)
??as_tbl_graph
library(tidygraph)
subgraph_tbl <- as_tbl_graph(subgraph)
subgraph_tbl <- subgraph_tbl %>%
activate(nodes) %>%
left_join(subg_plot, by = "name")
subg_plot <- data.frame(
name = V(subgraph)$name,
group = ifelse(V(subgraph)$name %in% fish_nodes, "Larval fish",
ifelse(V(subgraph)$name %in% cope_nodes, "Copepod", "other"))
)
subg_plot <- data.frame(
name = V(subgraph)$name,
group = ifelse(V(subgraph)$name %in% ic_fish_nodes, "Larval fish",
ifelse(V(subgraph)$name %in% ic_cope_nodes, "Copepod", "other"))
)
subgraph_tbl <- as_tbl_graph(subgraph)
subgraph_tbl <- subgraph_tbl %>%
activate(nodes) %>%
left_join(subg_plot, by = "name")
ggraph(subgraph_tbl * 1.5, layout = "fr") +
geom_edge_fan(aes(width = partcor, colour = partcor)) +
scale_edge_width(range = c(0.2, 2)) +
scale_edge_color_gradient2(low = "darkred",
mid = "cornsilk2",
high = "deepskyblue4",
midpoint = 0) +
geom_node_point(aes(colour = group, size = degree)) +
geom_node_text(aes(label = name, size = degree), repel = TRUE,
vjust = 1.7) +
scale_size_continuous(range = c(3, 5)) +
scale_color_manual(values = c("Larval fish" = "aquamarine4",
"Copepod" = "coral",
"Other" = "gray")) +
theme_void() +
theme(legend.position = 'none')
View(subgraph_tbl)
V(subgraph)$degree <- degree(subgraph)
subg_plot <- data.frame(
name = V(subgraph)$name,
group = ifelse(V(subgraph)$name %in% ic_fish_nodes, "Larval fish",
ifelse(V(subgraph)$name %in% ic_cope_nodes, "Copepod", "other"))
)
subgraph_tbl <- as_tbl_graph(subgraph)
subgraph_tbl <- subgraph_tbl %>%
activate(nodes) %>%
left_join(subg_plot, by = "name")
ggraph(subgraph_tbl * 1.5, layout = "fr") +
geom_edge_fan(aes(width = partcor, colour = partcor)) +
scale_edge_width(range = c(0.2, 2)) +
scale_edge_color_gradient2(low = "darkred",
mid = "cornsilk2",
high = "deepskyblue4",
midpoint = 0) +
geom_node_point(aes(colour = group, size = degree)) +
geom_node_text(aes(label = name, size = degree), repel = TRUE,
vjust = 1.7) +
scale_size_continuous(range = c(3, 5)) +
scale_color_manual(values = c("Larval fish" = "aquamarine4",
"Copepod" = "coral",
"Other" = "gray")) +
theme_void() +
theme(legend.position = 'none')
# full network
plot(subgraph)
# full network
plot(ig)
# remove isolated nodes
V(ig)$isolated <- degree(ig) == 0
# full network
plot(ig)
# full network
plot(ig$isolated)
# full network
plot(ig)
ig %>% ggraph('fr') +
geom_edge_link(aes(colour = partcor, width = partcor)) +
scale_edge_color_gradient2(low = "red",
mid = "grey",
high = "blue",
midpoint = 0) +
scale_edge_width(range = c(0.5, 3)) +
geom_node_text(aes(label = name,
),
repel = TRUE,
nudge_x = 1.15) +
geom_node_point(aes()) +
theme_bw() +
theme(legend.position = "right")
# full network
all_nodes <- V(ig)$name
View(labels)
my_nodes1 <- intersect(labels$., all_nodes)
fullgraph <- induced_subgraph(ig, vids = my_nodes1)
plot(fullgraph)
V(fullgraph)$degree <- degree(fullgraph)
fullgraph_tbl <- as_tbl_graph(fullgraph)
View(fullgraph)
View(subgraph_tbl)
View(labels)
fish_nodes <- labels$.[1:20, ]
fish_nodes <- labels[1:20, ]
fish_nodes
fish_nodes <- labels[1:22, ]
cope_nodes <- labels[23:62, ]
fullg_plot <- data.frame(
name = V(fullgraph)$name,
group = ifelse(V(fullgraph)$name %in% fish_nodes, "Larval fish",
ifelse(V(fullgraph)$name %in% cope_nodes, "Copepod", "other"))
)
fullgraph_tbl <- as_tbl_graph(fullgraph)
fullgraph_tbl <- fullgraph_tbl %>%
activate(nodes) %>%
left_join(subg_plot, by = "name")
ggraph(fullgraph_tbl * 1.5, layout = "fr") +
geom_edge_fan(aes(width = partcor, colour = partcor)) +
scale_edge_width(range = c(0.2, 2)) +
scale_edge_color_gradient2(low = "darkred",
mid = "cornsilk2",
high = "deepskyblue4",
midpoint = 0) +
geom_node_point(aes(colour = group, size = degree)) +
geom_node_text(aes(label = name, size = degree), repel = TRUE,
vjust = 1.7) +
scale_size_continuous(range = c(3, 5)) +
scale_color_manual(values = c("Larval fish" = "aquamarine4",
"Copepod" = "coral",
"Other" = "gray")) +
theme_void() +
theme(legend.position = 'none')
View(fullgraph_tbl)
# defining groups
fish_nodes <- labels[1:22, ]
cope_nodes <- labels[23:62, ]
fullg_plot <- data.frame(
name = V(fullgraph)$name,
group = ifelse(V(fullgraph)$name %in% fish_nodes, "Larval fish",
ifelse(V(fullgraph)$name %in% cope_nodes, "Copepod", "other"))
)
View(fullg_plot)
fullgraph_tbl <- as_tbl_graph(fullgraph)
fullgraph_tbl <- fullgraph_tbl %>%
activate(nodes) %>%
left_join(subg_plot, by = "name")
ggraph(fullgraph_tbl * 1.5, layout = "fr") +
geom_edge_fan(aes(width = partcor, colour = partcor)) +
scale_edge_width(range = c(0.2, 2)) +
scale_edge_color_gradient2(low = "darkred",
mid = "cornsilk2",
high = "deepskyblue4",
midpoint = 0) +
geom_node_point(aes(colour = group, size = degree)) +
geom_node_text(aes(label = name, size = degree), repel = TRUE,
vjust = 1.7) +
scale_size_continuous(range = c(3, 5)) +
scale_color_manual(values = c("Larval fish" = "aquamarine4",
"Copepod" = "coral",
"Other" = "gray")) +
theme_void() +
theme(legend.position = 'none')
# defining groups
fish_nodes <- labels[1:22, ]
cope_nodes <- labels[23:62, ]
fullg_plot <- data.frame(
name = V(fullgraph)$name,
group = ifelse(V(fullgraph)$name %in% fish_nodes, "Larval fish",
ifelse(V(fullgraph)$name %in% cope_nodes, "Copepod", "other"))
)
fullgraph_tbl <- as_tbl_graph(fullgraph)
fullgraph_tbl <- fullgraph_tbl %>%
activate(nodes) %>%
left_join(subg_plot, by = "name")
ggraph(fullgraph_tbl * 1.5, layout = "fr") +
geom_edge_fan(aes(width = partcor, colour = partcor)) +
scale_edge_width(range = c(0.2, 2)) +
scale_edge_color_gradient2(low = "darkred",
mid = "cornsilk2",
high = "deepskyblue4",
midpoint = 0) +
geom_node_point(aes(colour = group, size = degree)) +
geom_node_text(aes(label = name, size = degree), repel = TRUE,
vjust = 1.7) +
scale_size_continuous(range = c(3, 5)) +
scale_color_manual(values = c("Larval fish" = "aquamarine4",
"Copepod" = "coral",
"Other" = "gray")) +
theme_void() +
theme(legend.position = 'none')
View(fullg_plot)
# defining groups
fish_nodes <- labels[1:23, ]
cope_nodes <- labels[24:62, ]
fullg_plot <- data.frame(
name = V(fullgraph)$name,
group = ifelse(V(fullgraph)$name %in% fish_nodes, "Larval fish",
ifelse(V(fullgraph)$name %in% cope_nodes, "Copepod", "other"))
)
fullg_plot <- data.frame(
name = V(fullgraph)$name,
group = ifelse(V(fullgraph)$name %in% fish_nodes, "Larval fish",
ifelse(V(fullgraph)$name %in% cope_nodes, "Copepod", "Other"))
)
fullgraph_tbl <- as_tbl_graph(fullgraph)
fullgraph_tbl <- fullgraph_tbl %>%
activate(nodes) %>%
left_join(subg_plot, by = "name")
ggraph(fullgraph_tbl * 1.5, layout = "fr") +
geom_edge_fan(aes(width = partcor, colour = partcor)) +
scale_edge_width(range = c(0.2, 2)) +
scale_edge_color_gradient2(low = "darkred",
mid = "cornsilk2",
high = "deepskyblue4",
midpoint = 0) +
geom_node_point(aes(colour = group, size = degree)) +
geom_node_text(aes(label = name, size = degree), repel = TRUE,
vjust = 1.7) +
scale_size_continuous(range = c(3, 5)) +
scale_color_manual(values = c("Larval fish" = "aquamarine4",
"Copepod" = "coral",
"Other" = "gray")) +
theme_void() +
theme(legend.position = 'none')
igraph::V(fullgraph)$group
# base igraph
ig <- cgr$best_graph$igraph_out
# remove isolated nodes
V(ig)$isolated <- degree(ig) == 0
# full network
all_nodes <- V(ig)$name
# includes all nodes with > 0 connections
labels <- ifelse(node_degrees > 0, V(ig)$name, NA)
my_nodes1 <- intersect(labels$., all_nodes)
# full network
all_nodes <- V(ig)$name
# includes all nodes with > 0 connections
labels <- ifelse(node_degrees > 0, V(ig)$name, NA)
my_nodes1 <- intersect(labels$., all_nodes)
# includes all nodes with > 0 connections
labels <- ifelse(node_degrees > 0, V(ig)$name, NA) %>% as.character()
my_nodes1 <- intersect(labels$., all_nodes)
my_nodes1 <- intersect(labels, all_nodes)
fullgraph <- induced_subgraph(ig, vids = my_nodes1)
View(fullgraph)
# encode degree information
V(fullgraph)$degree <- degree(fullgraph)
# defining groups
fish_nodes <- labels[1:23, ]
# defining groups
fish_nodes <- labels[1:23]
# includes all nodes with > 0 connections
labels <- ifelse(node_degrees > 0, V(ig)$name, NA) %>% as.character()
# includes all nodes with > 0 connections
labels <- ifelse(node_degrees > 0, V(ig)$name, NA) %>% as.character() %>%
na.exclude()
my_nodes1 <- intersect(labels, all_nodes)
fullgraph <- induced_subgraph(ig, vids = my_nodes1)
# encode degree information
V(fullgraph)$degree <- degree(fullgraph)
# defining groups
fish_nodes <- labels[1:23]
fish_nodes
cope_nodes <- labels[24:62]
fullg_plot <- data.frame(
name = V(fullgraph)$name,
group = ifelse(V(fullgraph)$name %in% fish_nodes, "Larval fish",
ifelse(V(fullgraph)$name %in% cope_nodes, "Copepod", "Other"))
)
fullgraph_tbl <- as_tbl_graph(fullgraph)
fullgraph_tbl <- fullgraph_tbl %>%
activate(nodes) %>%
left_join(subg_plot, by = "name")
ggraph(fullgraph_tbl * 1.5, layout = "fr") +
geom_edge_fan(aes(width = partcor, colour = partcor)) +
scale_edge_width(range = c(0.2, 2)) +
scale_edge_color_gradient2(low = "darkred",
mid = "cornsilk2",
high = "deepskyblue4",
midpoint = 0) +
geom_node_point(aes(colour = group, size = degree)) +
geom_node_text(aes(label = name, size = degree), repel = TRUE,
vjust = 1.7) +
scale_size_continuous(range = c(3, 5)) +
scale_color_manual(values = c("Larval fish" = "aquamarine4",
"Copepod" = "coral",
"Other" = "gray")) +
theme_void() +
theme(legend.position = 'none')
View(fullgraph)
fullgraph$name
V(fullgraph)$name
View(fullg_plot)
fullgraph_tbl <- as_tbl_graph(fullgraph)
View(fullgraph_tbl)
fullgraph_tbl <- fullgraph_tbl %>%
activate(nodes) %>%
left_join(subg_plot, by = "name")
fullgraph_tbl <- fullgraph_tbl %>%
activate(nodes) %>%
left_join(fullg_plot, by = "name")
ggraph(fullgraph_tbl * 1.5, layout = "fr") +
geom_edge_fan(aes(width = partcor, colour = partcor)) +
scale_edge_width(range = c(0.2, 2)) +
scale_edge_color_gradient2(low = "darkred",
mid = "cornsilk2",
high = "deepskyblue4",
midpoint = 0) +
geom_node_point(aes(colour = group, size = degree)) +
geom_node_text(aes(label = name, size = degree), repel = TRUE,
vjust = 1.7) +
scale_size_continuous(range = c(3, 5)) +
scale_color_manual(values = c("Larval fish" = "aquamarine4",
"Copepod" = "coral",
"Other" = "gray")) +
theme_void() +
theme(legend.position = 'none')
# full network
all_nodes <- V(ig)$name
# includes all nodes with > 0 connections
labels <- ifelse(node_degrees > 0, V(ig)$name, NA) %>% as.character() %>%
na.exclude()
my_nodes1 <- intersect(labels, all_nodes)
fullgraph <- induced_subgraph(ig, vids = my_nodes1)
# encode degree information
V(fullgraph)$degree <- degree(fullgraph)
# defining groups
fish_nodes <- labels[1:23]
cope_nodes <- labels[24:62]
V(fullgraph)$name
fullg_plot <- data.frame(
name = V(fullgraph)$name,
group = ifelse(V(fullgraph)$name %in% fish_nodes, "Larval fish",
ifelse(V(fullgraph)$name %in% cope_nodes, "Copepod", "Other"))
)
fullgraph_tbl <- as_tbl_graph(fullgraph)
fullgraph_tbl <- fullgraph_tbl %>%
activate(nodes) %>%
left_join(fullg_plot, by = "name")
ggraph(fullgraph_tbl * 1.5, layout = "fr") +
geom_edge_fan(aes(width = partcor, colour = partcor)) +
scale_edge_width(range = c(0.2, 2)) +
scale_edge_color_gradient2(low = "darkred",
mid = "cornsilk2",
high = "deepskyblue4",
midpoint = 0) +
geom_node_point(aes(colour = group, size = degree)) +
geom_node_text(aes(label = name, size = degree), repel = TRUE,
vjust = 1.7) +
scale_size_continuous(range = c(3, 5)) +
scale_color_manual(values = c("Larval fish" = "aquamarine4",
"Copepod" = "coral",
"Other" = "gray")) +
theme_void() +
theme(legend.position = 'none')
# Load necessary packages
library(ggraph)
library(igraph)
library(tidygraph)
library(dplyr)
library(zoo)
# Load and preprocess data
data <- read.csv("stdset.csv") %>%
dplyr::select(where(~ !is.numeric(.) || is.numeric(.) &&
sum(., na.rm = T) > 0)) %>%
mutate(across(where(is.numeric), ~ na.approx(., na.rm = F, rule = 2)))
# Load necessary packages
library(ggraph)
library(igraph)
library(tidygraph)
library(dplyr)
library(zoo)
# Load and preprocess data
data <- read.csv("stdset.csv") %>%
dplyr::select(where(~ !is.numeric(.) || is.numeric(.) &&
sum(., na.rm = T) > 0)) %>%
mutate(across(where(is.numeric), ~ na.approx(., na.rm = F, rule = 2)))
# Create GLM and CGGM model
library(mvabund)
library(ecoCopula)
bio_resp <- data[12:235] %>% mvabund()
meta <- data[1:9]
mod <- manyany(
formula = bio_resp ~ meta$StationCode + meta$CTDSST_degC,
data = meta,
fn = "glm",
family = tweedie(var.power = 1.011, link.power = 0)
)
# Define node groups and create full network
labels <- V(ig)$name[degree(ig) > 0] %>% na.exclude()
fish_nodes <- labels[1:23]
cope_nodes <- labels[24:62]
fullgraph <- induced_subgraph(ig, vids = labels)
V(fullgraph)$degree <- degree(fullgraph)
fullg_plot <- data.frame(
name = V(fullgraph)$name,
group = ifelse(V(fullgraph)$name %in% fish_nodes, "Larval fish",
ifelse(V(fullgraph)$name %in% cope_nodes, "Copepod", "Other"))
)
fullgraph_tbl <- as_tbl_graph(fullgraph) %>%
activate(nodes) %>%
left_join(fullg_plot, by = "name")
# Plot full network
ggraph(fullgraph_tbl, layout = "fr") +
geom_edge_fan(aes(width = partcor, colour = partcor)) +
scale_edge_width(range = c(0.2, 2)) +
scale_edge_color_gradient2(low = "darkred", mid = "cornsilk2", high = "deepskyblue4", midpoint = 0) +
geom_node_point(aes(colour = group, size = degree)) +
geom_node_text(aes(label = name, size = degree), repel = TRUE, vjust = 1.7) +
scale_size_continuous(range = c(3, 5)) +
scale_color_manual(values = c("Larval fish" = "aquamarine4", "Copepod" = "coral", "Other" = "gray")) +
theme_void() +
theme(legend.position = 'none')
# Define subset nodes
ic_fish_nodes <- c("Trachurus.novaezelandiae", "Engraulis.australis", "Sardinops.sagax", "Scomber.australasicus")
ic_cope_nodes <- c("Acartia.tranteri", "Clausocalanus.furcatus", "Diothonia.rigida", "Euterpina.acutifrons",
"Microsetella.norvegica", "Oithona.atlantica", "Paracalanus.indicus", "Temora.turbinata")
subgraph <- induced_subgraph(ig, vids = intersect(c(ic_fish_nodes, ic_cope_nodes), V(ig)$name))
V(subgraph)$degree <- degree(subgraph)
subg_plot <- data.frame(
name = V(subgraph)$name,
group = ifelse(V(subgraph)$name %in% ic_fish_nodes, "Larval fish",
ifelse(V(subgraph)$name %in% ic_cope_nodes, "Copepod", "Other"))
)
subgraph_tbl <- as_tbl_graph(subgraph) %>%
activate(nodes) %>%
left_join(subg_plot, by = "name")
# Plot subset network
ggraph(subgraph_tbl, layout = "fr") +
geom_edge_fan(aes(width = partcor, colour = partcor)) +
scale_edge_width(range = c(0.2, 2)) +
scale_edge_color_gradient2(low = "darkred", mid = "cornsilk2", high = "deepskyblue4", midpoint = 0) +
geom_node_point(aes(colour = group, size = degree)) +
geom_node_text(aes(label = name, size = degree), repel = TRUE, vjust = 1.7) +
scale_size_continuous(range = c(3, 5)) +
scale_color_manual(values = c("Larval fish" = "aquamarine4", "Copepod" = "coral", "Other" = "gray")) +
theme_void() +
theme(legend.position = 'none')
